<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shuyi Qiu">

<title>HW9_syQiu</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="HW9_syQiu_files/libs/clipboard/clipboard.min.js"></script>
<script src="HW9_syQiu_files/libs/quarto-html/quarto.js"></script>
<script src="HW9_syQiu_files/libs/quarto-html/popper.min.js"></script>
<script src="HW9_syQiu_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="HW9_syQiu_files/libs/quarto-html/anchor.min.js"></script>
<link href="HW9_syQiu_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="HW9_syQiu_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="HW9_syQiu_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="HW9_syQiu_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="HW9_syQiu_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cappun-weekly" id="toc-cappun-weekly" class="nav-link active" data-scroll-target="#cappun-weekly">9.1 <code>cappun</code> &amp; <code>weekly</code></a>
  <ul class="collapse">
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section">9.1.1 2*2</a>
  <ul class="collapse">
  <li><a href="#linear-probability-model" id="toc-linear-probability-model" class="nav-link" data-scroll-target="#linear-probability-model">Linear Probability Model</a></li>
  <li><a href="#logistic-regression-model" id="toc-logistic-regression-model" class="nav-link" data-scroll-target="#logistic-regression-model">Logistic Regression Model</a></li>
  <li><a href="#bonus" id="toc-bonus" class="nav-link" data-scroll-target="#bonus">Bonus</a></li>
  </ul></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">9.1.2 2*2*2</a>
  <ul class="collapse">
  <li><a href="#linear-probability-model-1" id="toc-linear-probability-model-1" class="nav-link" data-scroll-target="#linear-probability-model-1">Linear Probability Model</a></li>
  <li><a href="#logistic-regression-model-1" id="toc-logistic-regression-model-1" class="nav-link" data-scroll-target="#logistic-regression-model-1">Logistic Regression Model</a></li>
  <li><a href="#bonus-1" id="toc-bonus-1" class="nav-link" data-scroll-target="#bonus-1">Bonus</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#xmarsex-married-sex" id="toc-xmarsex-married-sex" class="nav-link" data-scroll-target="#xmarsex-married-sex">9.2 xmarsex ~ married * sex</a>
  <ul class="collapse">
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2"></a></li>
  <li><a href="#linear-probability-model-2" id="toc-linear-probability-model-2" class="nav-link" data-scroll-target="#linear-probability-model-2">Linear Probability Model</a></li>
  <li><a href="#logistic-regression-model-2" id="toc-logistic-regression-model-2" class="nav-link" data-scroll-target="#logistic-regression-model-2">Logistic Regression Model</a></li>
  <li><a href="#bonus-2" id="toc-bonus-2" class="nav-link" data-scroll-target="#bonus-2">Bonus</a></li>
  </ul></li>
  <li><a href="#inter-generational-bachelors-degree" id="toc-inter-generational-bachelors-degree" class="nav-link" data-scroll-target="#inter-generational-bachelors-degree">9.3 Inter-generational Bachelor’s Degree</a>
  <ul class="collapse">
  <li><a href="#linear-probability-model-3" id="toc-linear-probability-model-3" class="nav-link" data-scroll-target="#linear-probability-model-3">Linear Probability Model</a></li>
  <li><a href="#logistic-regression-model-3" id="toc-logistic-regression-model-3" class="nav-link" data-scroll-target="#logistic-regression-model-3">Logistic Regression Model</a></li>
  <li><a href="#bonus-3" id="toc-bonus-3" class="nav-link" data-scroll-target="#bonus-3">Bonus</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HW9_syQiu</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shuyi Qiu </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Set up dataset and package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gssr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>(<span class="at">base_family =</span> <span class="st">"Optima"</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>gss18 <span class="ot">&lt;-</span> <span class="fu">gss_get_yr</span>(<span class="dv">2018</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="cappun-weekly" class="level1">
<h1>9.1 <code>cappun</code> &amp; <code>weekly</code></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> gss18 <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(attend, polviews, cappun) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_missing</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weekly =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(attend <span class="sc">&gt;=</span> <span class="dv">7</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-weekly"</span>, <span class="st">"Weekly"</span>)),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">conservative =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(polviews <span class="sc">&gt;=</span> <span class="dv">5</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-conservative"</span>, <span class="st">"Conservative"</span>)),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">penalty =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(cappun <span class="sc">==</span> <span class="dv">1</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Oppose"</span>,<span class="st">"Favor"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(penalty, weekly, conservative)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table</span>(d<span class="sc">$</span>weekly, d<span class="sc">$</span>penalty)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            
                Oppose     Favor
  Non-weekly 0.3585828 0.6414172
  Weekly     0.4043011 0.5956989</code></pre>
</div>
</div>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">9.1.1 2*2</h2>
<section id="linear-probability-model" class="level3">
<h3 class="anchored" data-anchor-id="linear-probability-model">Linear Probability Model</h3>
<p>As a linear probability model, the relationship between <code>cappun</code> (<span class="math inline">\(Y\)</span>) and <code>weekly</code> (<span class="math inline">\(X\)</span>) can be expressed as following:</p>
<p><span class="math display">\[
Y=\alpha+\beta X
\]</span></p>
<p>Based on the contingency table, we can calculate the value of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math inline">\(\alpha\)</span> = 0.6414</p>
<p><span class="math inline">\(\beta\)</span> = -0.0457</p>
<p>The value of <span class="math inline">\(\beta\)</span> indicates that the probability of those who favor the death penalty for those who convicted murder is lower among those who attend the religious services weekly than among those who do not by 4.57 percentage points.</p>
</section>
<section id="logistic-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model">Logistic Regression Model</h3>
<p>As a logistic regression model, the relationship between <code>cappun</code> (<span class="math inline">\(Y\)</span>) and <code>weekly</code> (<span class="math inline">\(X\)</span>) can also be expressed using the above model, but the left hand side is the logit.</p>
<p>Based on the contingency table, we can calculate the value of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math inline">\(\alpha\)</span> = 0.5815</p>
<p><span class="math inline">\(\beta\)</span> = -0.1939</p>
<p>The value of <span class="math inline">\(\beta\)</span> indicates that those who attend the religious services weekly have a lower log odds of favoring death penalty for murderers than those who do not by 0.19</p>
</section>
<section id="bonus" class="level3">
<h3 class="anchored" data-anchor-id="bonus">Bonus</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>boot_df <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(penalty <span class="sc">~</span> weekly, <span class="at">success =</span> <span class="st">"Favor"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="st">"diff in props"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"Weekly"</span>,<span class="st">"Non-weekly"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(boot_df<span class="sc">$</span>stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.04660175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(boot_df<span class="sc">$</span>stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02529412</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">&lt;-</span> boot_df <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_confidence_interval</span>(<span class="at">level =</span> <span class="fl">0.95</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ci</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  lower_ci upper_ci
     &lt;dbl&gt;    &lt;dbl&gt;
1  -0.0951  0.00285</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>boot_df <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visualise</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_ci</span>(ci)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="HW9_syQiu_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The standard error of <span class="math inline">\(\beta\)</span> is 0.0253 , as estimated from the bootstrap simulation. The 95% confidence interval is (-0.0951, 0.0029).</p>
</section>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">9.1.2 2*2*2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table</span>(d<span class="sc">$</span>weekly, d<span class="sc">$</span>penalty, d<span class="sc">$</span>conservative)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>crosstab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, ,  = Non-conservative

            
             Oppose Favor
  Non-weekly    485   682
  Weekly        115   123

, ,  = Conservative

            
             Oppose Favor
  Non-weekly    102   368
  Weekly         73   154</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, ,  = Non-conservative

            
                Oppose     Favor
  Non-weekly 0.4155955 0.5844045
  Weekly     0.4831933 0.5168067

, ,  = Conservative

            
                Oppose     Favor
  Non-weekly 0.2170213 0.7829787
  Weekly     0.3215859 0.6784141</code></pre>
</div>
</div>
<p>The relationship between <code>cappun</code> (<span class="math inline">\(Y\)</span>), <code>weekly</code> (<span class="math inline">\(X_1\)</span>) and <code>conservative</code> (<span class="math inline">\(X_2\)</span>) could be written as the following model with interactive term:</p>
<p><span class="math display">\[
Y = \alpha+\beta_1X_1+\beta_2X_2+\beta_3X_1X_2
\]</span></p>
<section id="linear-probability-model-1" class="level3">
<h3 class="anchored" data-anchor-id="linear-probability-model-1">Linear Probability Model</h3>
<p>The left hand side of the model is the conditional probability of <span class="math inline">\(Y = 1\)</span> in the linear probability model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">-</span>alpha</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = 0.5844</p>
<p><span class="math inline">\(\beta_1\)</span> = -0.0676</p>
<p><span class="math inline">\(\beta_2\)</span> = 0.1986</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.037</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: attending religious services weekly alone decreases the probability of favoring the penalty for murderers by -6.76 percentage points.</p>
<p><span class="math inline">\(\beta_2\)</span>: being conservative alone increases the probability of favoring the penalty for murderers by 19.86 percentage points.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: attending religious services weekly as well as being conservative together would increase the probability of favoring the penalty for murderers by 9.4 percentage points.</p>
</section>
<section id="logistic-regression-model-1" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model-1">Logistic Regression Model</h3>
<p>The left hand side of the model is the logit of <span class="math inline">\(Y\)</span> in the logistic regression model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>])<span class="sc">-</span>alpha</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = 0.3409</p>
<p><span class="math inline">\(\beta_1\)</span> = -0.2736</p>
<p><span class="math inline">\(\beta_2\)</span> = 0.9422</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.263</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: attending religious services weekly alone decreases the odds of favoring the penalty for murderers by 0.76 times.</p>
<p><span class="math inline">\(\beta_2\)</span>: being conservative alone increases the odds of favoring the penalty for murderers by 2.57 times.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: attending religious services weekly as well as being conservative together would increase the odds of favoring the penalty for murderers by 1.5 times.</p>
</section>
<section id="bonus-1" class="level3">
<h3 class="anchored" data-anchor-id="bonus-1">Bonus</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>boot_df <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">penalty =</span> <span class="fu">as.numeric</span>(penalty) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(penalty <span class="sc">~</span> weekly <span class="sc">*</span> conservative) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>observed_fit <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">penalty =</span> <span class="fu">as.numeric</span>(penalty) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(penalty <span class="sc">~</span> weekly <span class="sc">*</span> conservative) <span class="sc">%&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>coef_estimate <span class="ot">&lt;-</span> boot_df <span class="sc">|&gt;</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">|&gt;</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_coef =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_coef =</span> <span class="fu">sd</span>(estimate)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">get_confidence_interval</span>(</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  boot_df,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_estimate =</span> observed_fit,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> .<span class="dv">95</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>result_df <span class="ot">&lt;-</span> coef_estimate <span class="sc">|&gt;</span> </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ci_df, <span class="at">by =</span> <span class="st">"term"</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term                                  mean_coef sd_coef lower_ci upper_ci
  &lt;chr&gt;                                     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 conservativeConservative                 0.198   0.0237    0.152 0.245   
2 intercept                                0.584   0.0144    0.556 0.612   
3 weeklyWeekly                            -0.0679  0.0353   -0.135 0.000577
4 weeklyWeekly:conservativeConservative   -0.0366  0.0504   -0.135 0.0602  </code></pre>
</div>
</div>
<p>Therefore the standard error of <span class="math inline">\(\beta_{weekly}\)</span> in the linear probability model is 0.0353. The confidence interval is (-0.1346, 6^{-4})</p>
</section>
</section>
</section>
<section id="xmarsex-married-sex" class="level1">
<h1>9.2 xmarsex ~ married * sex</h1>
<p>The relationship between <code>exmarsex</code> (<span class="math inline">\(Y\)</span>), <code>married</code> (<span class="math inline">\(X_1\)</span>) and <code>female</code> (<span class="math inline">\(X_2\)</span>) could be written as the following model with interactive term:</p>
<p><span class="math display">\[
Y = \alpha+\beta_1X_1+\beta_2X_2+\beta_3X_1X_2
\]</span></p>
<section id="section-2" class="level3">
<h3 class="anchored" data-anchor-id="section-2"></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> gss18 <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(marital, sex, xmarsex) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_missing</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">married =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(marital <span class="sc">==</span> <span class="dv">1</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not married"</span>, <span class="st">"Married"</span>)),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">female =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="dv">2</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>)),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">exmarsex =</span> <span class="fu">factor</span>(<span class="fu">if_else</span>(xmarsex <span class="sc">==</span> <span class="dv">1</span>, 1L, 0L), <span class="at">levels =</span> <span class="fu">c</span>(0L, 1L), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Not always"</span>, <span class="st">"Always"</span>))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(married, female, exmarsex)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table</span>(d<span class="sc">$</span>married, d<span class="sc">$</span>exmarsex, d<span class="sc">$</span>female)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>crosstab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, ,  = Male

             
              Not always Always
  Not married        128    278
  Married             77    207

, ,  = Female

             
              Not always Always
  Not married        103    392
  Married             72    294</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, ,  = Male

             
              Not always    Always
  Not married  0.3152709 0.6847291
  Married      0.2711268 0.7288732

, ,  = Female

             
              Not always    Always
  Not married  0.2080808 0.7919192
  Married      0.1967213 0.8032787</code></pre>
</div>
</div>
</section>
<section id="linear-probability-model-2" class="level3">
<h3 class="anchored" data-anchor-id="linear-probability-model-2">Linear Probability Model</h3>
<p>The left hand side of the model is the conditional probability of <span class="math inline">\(Y = 1\)</span> in the linear probability model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">-</span>alpha</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = 0.6847</p>
<p><span class="math inline">\(\beta_1\)</span> = 0.0441</p>
<p><span class="math inline">\(\beta_2\)</span> = 0.1072</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.0328</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: getting married alone increases the probability of always think extra-marital sex wrong by 4.41 percentage points.</p>
<p><span class="math inline">\(\beta_2\)</span>: being female alone increases the probability of always think extra-marital sex wrong by 10.72 percentage points.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: getting married as well as being female together would increase the probability of always think extra-marital sex wrong by 11.85 percentage points.</p>
</section>
<section id="logistic-regression-model-2" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model-2">Logistic Regression Model</h3>
<p>The left hand side of the model is the logit of <span class="math inline">\(Y\)</span> in the logistic regression model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>])<span class="sc">-</span>alpha</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = 0.7756</p>
<p><span class="math inline">\(\beta_1\)</span> = 0.2133</p>
<p><span class="math inline">\(\beta_2\)</span> = 0.5609</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.1429</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: getting married alone increases the odds of always think extra-marital sex wrong by 1.24 times.</p>
<p><span class="math inline">\(\beta_2\)</span>: being female alone increases the odds of always think extra-marital sex wrong by 1.75 times.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: getting married as well as being female together would increase the odds of always think extra-marital sex wrong by by 1.88 times.</p>
</section>
<section id="bonus-2" class="level3">
<h3 class="anchored" data-anchor-id="bonus-2">Bonus</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>boot_df <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exmarsex =</span> <span class="fu">as.numeric</span>(exmarsex) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(exmarsex <span class="sc">~</span>  married <span class="sc">*</span> female) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>observed_fit <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exmarsex =</span> <span class="fu">as.numeric</span>(exmarsex) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(exmarsex <span class="sc">~</span>  married <span class="sc">*</span> female) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>coef_estimate <span class="ot">&lt;-</span> boot_df <span class="sc">|&gt;</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">|&gt;</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_coef =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_coef =</span> <span class="fu">sd</span>(estimate)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">get_confidence_interval</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  boot_df,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_estimate =</span> observed_fit,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> .<span class="dv">95</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>result_df <span class="ot">&lt;-</span> coef_estimate <span class="sc">|&gt;</span> </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ci_df, <span class="at">by =</span> <span class="st">"term"</span>)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term                        mean_coef sd_coef lower_ci upper_ci
  &lt;chr&gt;                           &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 femaleFemale                   0.108   0.0296   0.0507   0.166 
2 intercept                      0.685   0.0233   0.639    0.729 
3 marriedMarried                 0.0445  0.0351  -0.0257   0.112 
4 marriedMarried:femaleFemale   -0.0336  0.0452  -0.123    0.0538</code></pre>
</div>
</div>
</section>
</section>
<section id="inter-generational-bachelors-degree" class="level1">
<h1>9.3 Inter-generational Bachelor’s Degree</h1>
<p>The relationship between <code>r_gtba</code> (<span class="math inline">\(Y\)</span>), <code>f_gtba</code> (<span class="math inline">\(X_1\)</span>) and <code>m_gtba</code> (<span class="math inline">\(X_2\)</span>) could be written as the following model with interactive term:</p>
<p><span class="math display">\[
Y = \alpha+\beta_1X_1+\beta_2X_2+\beta_3X_1X_2
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> gss18 <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(degree, padeg, madeg) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_missing</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  haven<span class="sc">::</span><span class="fu">zap_labels</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_gtba =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(degree <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No BA"</span>, <span class="st">"BA or more"</span>)),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">f_gtba =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(padeg <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No BA"</span>, <span class="st">"BA or more"</span>)),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">m_gtba =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(madeg <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No BA"</span>, <span class="st">"BA or more"</span>))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(r_gtba, f_gtba, m_gtba)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>crosstab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">father =</span> d<span class="sc">$</span>f_gtba, <span class="at">resp =</span> d<span class="sc">$</span>r_gtba, <span class="at">mother =</span> d<span class="sc">$</span>m_gtba)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>crosstab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , mother = No BA

            resp
father       No BA BA or more
  No BA        880        303
  BA or more    69         83

, , mother = BA or more

            resp
father       No BA BA or more
  No BA         53         63
  BA or more    54        141</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , mother = No BA

            resp
father           No BA BA or more
  No BA      0.7438715  0.2561285
  BA or more 0.4539474  0.5460526

, , mother = BA or more

            resp
father           No BA BA or more
  No BA      0.4568966  0.5431034
  BA or more 0.2769231  0.7230769</code></pre>
</div>
</div>
<section id="linear-probability-model-3" class="level3">
<h3 class="anchored" data-anchor-id="linear-probability-model-3">Linear Probability Model</h3>
<p>The left hand side of the model is the conditional probability of <span class="math inline">\(Y = 1\)</span> in the linear probability model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">-</span>alpha</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">prop.table</span>(crosstab, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = 0.2561</p>
<p><span class="math inline">\(\beta_1\)</span> = 0.2899</p>
<p><span class="math inline">\(\beta_2\)</span> = 0.287</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.11</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: father’s having bachelor degree increases the probability of child’s having bachelor’s degree by 28.99 percentage points.</p>
<p><span class="math inline">\(\beta_2\)</span>: mother’s having bachelor degree increases the probability of child’s having bachelor’s degree by 28.7 percentage points.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: parents’ both having bachelor’s degree would increase the probability of child’s having bachelor’s degree by 46.69 percentage points.</p>
</section>
<section id="logistic-regression-model-3" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-model-3">Logistic Regression Model</h3>
<p>The left hand side of the model is the logit of <span class="math inline">\(Y\)</span> in the logistic regression model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>])<span class="sc">-</span>alpha</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>beta2 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">=</span> <span class="fu">log</span>(crosstab[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>crosstab[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">-</span>alpha<span class="sc">-</span>beta1<span class="sc">-</span>beta2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\(\alpha\)</span> = -1.0662</p>
<p><span class="math inline">\(\beta_1\)</span> = 1.2509</p>
<p><span class="math inline">\(\beta_2\)</span> = 1.239</p>
<p><span class="math inline">\(\beta_3\)</span> = -0.464</p>
<p>Interpretation of coefficients:</p>
<p><span class="math inline">\(\beta_1\)</span>: father’s having bachelor degree increases the odds of child’s having bachelor’s degree by 3.49 times.</p>
<p><span class="math inline">\(\beta_2\)</span>: mother’s having bachelor degree increases the odds of child’s having bachelor’s degree by 3.45 times.</p>
<p><span class="math inline">\(\beta_1+\beta_2+\beta_3\)</span>: parents’ both having bachelor’s degree would increase the odds of child’s having bachelor’s degree by 7.58 times.</p>
</section>
<section id="bonus-3" class="level3">
<h3 class="anchored" data-anchor-id="bonus-3">Bonus</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>boot_df <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_gtba =</span> <span class="fu">as.numeric</span>(r_gtba) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(r_gtba <span class="sc">~</span>  f_gtba <span class="sc">*</span> m_gtba) <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">5000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>observed_fit <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_gtba =</span> <span class="fu">as.numeric</span>(r_gtba) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(r_gtba <span class="sc">~</span>  f_gtba <span class="sc">*</span> m_gtba) <span class="sc">%&gt;%</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>coef_estimate <span class="ot">&lt;-</span> boot_df <span class="sc">|&gt;</span> </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">|&gt;</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_coef =</span> <span class="fu">mean</span>(estimate),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_coef =</span> <span class="fu">sd</span>(estimate)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>ci_df <span class="ot">&lt;-</span> <span class="fu">get_confidence_interval</span>(</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  boot_df,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">point_estimate =</span> observed_fit,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> .<span class="dv">95</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>result_df <span class="ot">&lt;-</span> coef_estimate <span class="sc">|&gt;</span> </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ci_df, <span class="at">by =</span> <span class="st">"term"</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term                              mean_coef sd_coef lower_ci upper_ci
  &lt;chr&gt;                                 &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 f_gtbaBA or more                      0.290  0.0426    0.206   0.374 
2 f_gtbaBA or more:m_gtbaBA or more    -0.108  0.0692   -0.241   0.0282
3 intercept                             0.256  0.0128    0.231   0.282 
4 m_gtbaBA or more                      0.286  0.0475    0.191   0.378 </code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>